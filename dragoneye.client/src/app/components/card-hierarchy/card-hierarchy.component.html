<div class="section-card">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h6 class="section-title mb-0">Card Groups</h6>
    <button class="btn btn-sm btn-outline-primary" (click)="onAddGroup()">
      <i class="bi bi-plus-circle me-1"></i> Group
    </button>
  </div>

  <div *ngFor="let group of cardData.groups; let gi = index" class="group-section mb-2">
    <div class="group-header" [class.editing]="editingGroupIndex === gi">
      <div class="group-header-content" (click)="onToggleGroup(gi)">
        <i class="bi me-2" [class.bi-chevron-right]="!group.expanded" [class.bi-chevron-down]="group.expanded"></i>
        
        <span *ngIf="editingGroupIndex !== gi" class="group-name-display">{{ group.name }}</span>
        <input *ngIf="editingGroupIndex === gi" type="text" class="form-control form-control-sm group-name-input"
               [(ngModel)]="group.name" (blur)="finishEditingGroup()" (keydown.enter)="finishEditingGroup()" (keydown.escape)="finishEditingGroup()">

        <span class="badge bg-secondary ms-auto">{{ group.cards.length }}</span>
      </div>

      <div class="group-actions">
        <button class="btn btn-sm btn-outline-secondary" (click)="startEditingGroup(gi, $event)" *ngIf="editingGroupIndex !== gi">
          <i class="bi bi-pencil"></i>
        </button>
        <div class="dropdown" *ngIf="editingGroupIndex !== gi">
          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" (click)="onDuplicateGroup(gi); $event.preventDefault()">Duplicate</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" (click)="onRemoveGroup(gi); $event.preventDefault()" [class.disabled]="cardData.groups.length === 1">Delete</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="group-content" *ngIf="group.expanded">
      <div *ngFor="let card of group.cards; let ci = index" class="card-item" [class.active]="gi === selectedGroupIndex && ci === selectedCardIndex">
        <div class="card-item-content" (click)="onSelectCard(gi, ci)">
          <div class="card-title">{{ card.title }}</div>
          <div class="card-meta">
            <span class="element-badge" [class]="cardService.getElementCssClass(card.element)">
              {{ cardService.getElementSymbol(card.element) }} {{ cardService.getElementName(card.element) }}
            </span>
            <span class="detail-count">{{ card.details.length }} detail{{ card.details.length !== 1 ? 's' : '' }}</span>
          </div>
        </div>

        <div class="dropdown card-item-actions">
          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" (click)="onDuplicateCard(gi, ci); $event.preventDefault()">Duplicate</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" (click)="onRemoveCard(gi, ci); $event.preventDefault()">Delete</a></li>
          </ul>
        </div>
      </div>

      <button class="btn btn-sm btn-outline-secondary mt-2 w-100" (click)="onAddCard(gi)">
        <i class="bi bi-plus me-1"></i> Add Card
      </button>
    </div>
  </div>
</div>
