<div class="card-display" (mousedown)="onMouseDown($event)" (wheel)="onWheel($event)">
  <div class="zoom-controls">
    <button class="btn btn-sm btn-outline-secondary" (click)="zoomOut()">
      <i class="bi bi-dash"></i>
    </button>
    <span class="zoom-level">{{ (zoomPanService.currentScale * 100).toFixed(0) }}%</span>
    <button class="btn btn-sm btn-outline-secondary" (click)="zoomIn()">
      <i class="bi bi-plus"></i>
    </button>
    <button class="btn btn-sm btn-outline-secondary ms-2" (click)="resetView()">
      <i class="bi bi-house"></i>
    </button>
  </div>

  <div class="card-viewport" #cardViewport>
    <svg *ngIf="card" viewBox="0 0 200 280" class="displayed-card">
      <defs>
        <radialGradient id="cardBg" cx="50%" cy="40%" r="60%">
          <stop offset="0%" style="stop-color:#f4f1e8" />
          <stop offset="100%" style="stop-color:#d4c4a0" />
        </radialGradient>
        <filter id="shadow">
          <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.3" />
        </filter>
        <clipPath id="imageClip">
          <rect x="20" y="70" width="160" height="185" />
        </clipPath>
      </defs>

      <rect x="10" y="10" width="180" height="260" fill="url(#cardBg)" stroke="#8b7355" stroke-width="2" filter="url(#shadow)" />
      <rect x="20" y="20" width="145" height="24" fill="white" stroke="#666" stroke-width="1" />
      
      <text x="25" y="36" font-size="11" font-weight="bold" fill="#333" font-family="serif">{{ card.title }}</text>

      <circle cx="165" cy="32" r="16" fill="white" stroke="#666" stroke-width="1" />
      <text x="165" y="38" text-anchor="middle" font-size="16" fill="#333">{{ elementSymbol }}</text>

      <rect x="25" y="50" width="40" height="12" fill="#333" />
      <text x="45" y="59" text-anchor="middle" fill="white" font-size="8" font-family="serif">
        {{ (card.type || 'CREATURE').toUpperCase() }}
      </text>

      <!-- Background image extends all the way down to bottom of description box -->
      <rect x="20" y="70" width="160" height="185" fill="#f8f9fa" stroke="#ddd" stroke-width="1" />
      <image *ngIf="card.backgroundImage" [attr.href]="card.backgroundImage" x="20" y="70" width="160" height="185" preserveAspectRatio="xMidYMid slice" clip-path="url(#imageClip)" />
      <text *ngIf="!card.backgroundImage" x="100" y="160" text-anchor="middle" fill="#999" font-size="10">No Image</text>

      <!-- Description box with higher position and opacity -->
      <rect x="20" y="180" width="160" height="75" fill="white" fill-opacity="0.8" stroke="#666" stroke-width="1" />

      <!-- Dynamic detail layout -->
      <g *ngFor="let layout of detailLayouts; let i = index">
        <!-- AP/SP circles -->
        <circle *ngFor="let ap of getCircles(layout.detail.apCost); let j = index"
                [attr.cx]="28 + (j * 8)" 
                [attr.cy]="getDetailCircleY(i)" 
                r="3" fill="white" stroke="#333" stroke-width="0.5" />
        <circle *ngFor="let sp of getCircles(layout.detail.spCost); let j = index"
                [attr.cx]="28 + ((layout.detail.apCost + j) * 8)" 
                [attr.cy]="getDetailCircleY(i)" 
                r="3" fill="#333" stroke="#333" stroke-width="0.5" />

        <!-- Detail title -->
        <text [attr.x]="layout.titleX" 
              [attr.y]="getDetailTitleY(i)" 
              font-size="7" fill="#333" font-family="serif" font-weight="bold">
          {{ layout.detail.name }}
        </text>

        <!-- Dynamic multi-line text -->
        <text x="28" [attr.y]="getDetailTextY(i)" font-size="6" fill="#333" font-family="serif">
          <tspan *ngFor="let line of layout.lines; let lineIndex = index"
                 x="28" 
                 [attr.dy]="lineIndex === 0 ? 0 : 7">
            {{ line.text }}
          </tspan>
        </text>
      </g>

      <!-- Show count of hidden details -->
      <text *ngIf="getHiddenDetailsCount() > 0" 
            x="100" y="250" 
            text-anchor="middle" fill="#666" font-size="8" font-family="serif">
        +{{ getHiddenDetailsCount() }} more...
      </text>
    </svg>

    <div *ngIf="!card" class="no-selection">
      <h5>No Card Selected</h5>
      <p>{{ noCardMessage }}</p>
    </div>
  </div>
</div>
